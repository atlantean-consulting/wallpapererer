<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 7, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2 | 10:39 AM | ✅ | Created Python dependencies file for wallpaper script project | ~230 |
</claude-mem-context>

# Project: wallpapererer

A collection of Python scripts for fetching and compositing desktop wallpapers on Linux.

## Scripts

### `wallpaper_combiner.py`
Stitches multiple images together into a single wide wallpaper for multi-monitor setups.

### `scrape_bing.py`
Bulk-downloads the Bing Wallpaper archive from https://bingwallpaper.anerg.com/ (covers 2009–present).

**How it works:**
- Iterates monthly archive pages at `/archive/us/YYYYMM`
- Extracts image IDs from `/detail/us/{ImageID}` links
- Downloads directly from `img.nanxiongnandi.com/{YYYYMM}/{ImageID}.jpg` (no auth required)
- Falls back to fetching the detail page for a signed 4K imgproxy URL if the CDN fails
- Saves progress to `scrape_state.json` so runs are resumable

**Key flags:**
```
--reverse        newest-first (best for grabbing 4K images; old ones are low-res)
--start YYYYMM   first month (default: 200906)
--end   YYYYMM   last month  (default: current month)
--output DIR     where to save (default: ./bing_wallpapers)
--delay SECS     pause between requests (default: 1.0)
--direct-only    skip detail-page fallback (CDN only)
--cdn-first      try CDN before detail page (faster but lower JPEG quality)
--reset          ignore saved state
```

**Notes:**
- Images before ~2013 are often only 958×512; use `--reverse` to get 4K-era images first
- Genuine 4K JPEGs are typically 2–6 MB; 1080p ones ~500 KB+

### `scrape_metadata.py`
Fetches image descriptions from bingwallpaper.anerg.com detail pages and embeds them as EXIF
metadata into already-downloaded JPEGs. Uses `piexif.insert()` — lossless, no recompression.

**Embedded fields:** `ImageDescription`, `Artist`, `Copyright`, `XPTitle` (image ID),
`XPComment` (full caption), `DateTimeOriginal` (from filename month).

**Key flags:**
```
--input DIR   directory of wallpapers (default: ./bing_wallpapers)
--delay SECS  pause between requests (default: 1.0)
--dry-run     preview without modifying files
--force       re-fetch even if EXIF is already present
--reset       ignore saved state
```

**Notes:**
- Saves progress to `metadata_state.json`; idempotent — re-running skips already-tagged files
- Caption format: `Description (© Photographer/Company)(Bing United States)`

### `sort_by_resolution.py`
Moves wallpapers into `high/`, `medium/`, and `low/` subfolders based on image width.

**Tiers:**
- `high/` — ≥ 3840 px wide (4K)
- `medium/` — ≥ 1920 px wide (1080p / 2K)
- `low/` — < 1920 px wide (older low-res images)

**Key flags:**
```
--input DIR   directory of wallpapers (default: ./bing_wallpapers)
--dry-run     preview without moving files
```

**Notes:**
- Only moves files directly in the input directory; files already in subfolders are untouched
- Safe to re-run (idempotent)

### `set_wallpaper.py`
Picks a wallpaper from `bing_wallpapers/high/` and applies it via `gsettings`. Prints the
image's EXIF caption and photographer credit after applying.

By default uses a date-seeded random choice (stable all day, rotates at midnight). Use
`--random` for a fresh pick on every run.

**Key flags:**
```
--input DIR      catalog directory (default: ./bing_wallpapers/high)
--month YYYYMM   restrict to images from one month (e.g. 202602)
--random         pick a new random image each run instead of date-seeded
--dry-run        show which image would be selected without applying
```

### `set_combined_wallpaper.py`
Picks two wallpapers, composites them via `wallpaper_combiner.py` (one on the center
monitor, one on both side monitors), saves the result to `combined_wallpaper.png`, and
applies it with `picture-options: spanned`. Same date-seeded / `--random` / `--month`
flags as `set_wallpaper.py`.

**Key flags:**
```
--input DIR      catalog directory (default: ./bing_wallpapers/high)
--output FILE    combined image path (default: ./combined_wallpaper.png)
--month YYYYMM   restrict to images from one month
--random         pick new random images each run instead of date-seeded
--dry-run        show which images would be picked without compositing or applying
```

### `fix_wallpaper_resolution.sh`
Fixes the post-suspend wallpaper resolution degradation bug on multi-monitor Cinnamon
setups. Toggles `picture-options` from `zoom` → `spanned` with a 2-second pause to force
a full-resolution redraw.

### `sync_latest.sh`
Wrapper script that orchestrates the full daily sync: download current + previous month,
embed metadata, move any new root-level files to `bing_wallpapers/high/`, then apply
today's wallpaper via `set_wallpaper.py`.

Before invoking the scraper it counts `bing_wallpapers/high/YYYYMM*` files and compares
that to today's day-of-month. If the count is short (i.e. today's image hasn't been
downloaded yet), it evicts the current month from `scrape_state.json`'s `done_months` so
the scraper re-checks the archive page. Already-downloaded images are still skipped via
`done_images`, so only genuinely new files are fetched.

Pass `--no-apply` to skip the wallpaper step (e.g. for headless/server use).

Intended to be run by the systemd user timer (see **Automation** below), but can also be
invoked manually.

### `sync_latest_multi.sh`
Identical to `sync_latest.sh` but calls `set_combined_wallpaper.py` at the end instead of
`set_wallpaper.py`. Use this on the home desktop with the three-monitor setup. Also
accepts `--no-apply`.

## Automation

A systemd user timer fires the sync daily, and catches up automatically if the machine was
off at the scheduled time (`Persistent=true`).

**Unit files:**
- `~/.config/systemd/user/wallpapererer-sync.service`
- `~/.config/systemd/user/wallpapererer-sync.timer`

**Enable (one-time setup):**
```bash
systemctl --user daemon-reload
systemctl --user enable --now wallpapererer-sync.timer
```

**Check status:**
```bash
systemctl --user list-timers wallpapererer-sync.timer
journalctl --user -u wallpapererer-sync.service
```

Logs also append to `sync.log` in the project directory.

## Dependencies
See `requirements.txt`: Pillow, requests, beautifulsoup4, piexif